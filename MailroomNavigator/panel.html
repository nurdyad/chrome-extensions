<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>BetterLetter All-in-One</title>
  <link rel="stylesheet" href="css/utilities.css">
  <link rel="stylesheet" href="css/layout.css">
  <link rel="stylesheet" href="css/buttons.css">
  <link rel="stylesheet" href="css/inputs.css">
  <link rel="stylesheet" href="css/status.css">
</head>
<body>
  <div class="btn-row global-nav-buttons-row">
    <button id="navigatorGlobalToggleBtn" class="btn active-tab">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <circle cx="12" cy="12" r="10"></circle>
        <line x1="12" y1="8" x2="12" y2="12"></line>
        <line x1="12" y1="16" x2="12.01" y2="16"></line>
      </svg>
      Navigator
    </button>
    <button id="jobManagerGlobalToggleBtn" class="btn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
        <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
      </svg>
      Job Panel
    </button>
    <button id="emailFormatterGlobalToggleBtn" class="btn">
      <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
        <polyline points="22,6 12,13 2,6"></polyline>
      </svg>
      Email
    </button>
  </div>

  <div id="practiceNavigatorView" class="view-transition">
    <h1>Practice Navigator</h1>
    
    <div style="margin-bottom: 15px;">
      <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 5px;">
        <label for="practiceInput" style="margin-bottom: 0; flex-shrink: 0;">Create or View practices and users</label>
        <div style="display: flex; gap: 4px;"> <button id="createPracticeAdminBtn" class="btn btn-sm" title="New Practice">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
            </button>
            <button id="usersBtn" class="btn btn-sm" disabled title="View Users">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
            </button>
            <button id="practicesBtn" class="btn btn-sm" title="All Practices">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            </button>
        </div>
      </div>

      <div class="search-container" style="position: relative;">
          <div class="input-with-button" style="margin-bottom: 0;">
            <input id="practiceInput" placeholder="Enter Practice Name or ODS code" autocomplete="off">
            <button id="resetSettingsBtn" class="btn btn-sm" title="Reset">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M2.5 2v6h6M21.5 22v-6h-6"></path>
                <path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2"></path>
              </svg>
            </button>
          </div>
          <button id="liveRefreshBtn" class="btn btn-sm" title="Live Refresh" style="position: absolute; right: -40px; top: 0; background-color: #3498db;">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2.5 2v6h6M21.5 22v-6h-6"></path><path d="M22 11.5A10 10 0 0 0 3.2 7.2M2 12.5a10 10 0 0 0 18.8 4.2"></path></svg>
          </button>
          <ul id="suggestions"></ul>
      </div>
    </div>

    <div class="action-grid">
      <button id="collectionBtn" class="btn btn-sm" disabled>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
            <polyline points="3.27 6.96 12 12.01 20.73 6.96"></polyline>
            <line x1="12" y1="22.08" x2="12" y2="12"></line>
        </svg>
        Collection
      </button>

      <button id="preparingBtn" class="btn btn-sm" disabled>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        Preparing
      </button>

      <button id="rejectedBtn" class="btn btn-sm" disabled>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="6" x2="6" y2="18"></line>
          <line x1="6" y1="6" x2="18" y2="18"></line>
        </svg>
        Rejected
      </button>

      <button id="openEhrSettingsBtn" class="btn btn-sm" disabled style="background-color: #6c757d;">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="3" y="3" width="18" height="18" rx="2"></rect>
          <line x1="12" y1="8" x2="12" y2="16"></line>
          <line x1="8" y1="12" x2="16" y2="12"></line>
        </svg>
        Settings
      </button>

      <button id="taskRecipientsBtn" class="btn btn-sm" disabled>
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="8.5" cy="7" r="4"></circle>
          <line x1="20" y1="8" x2="20" y2="14"></line>
          <line x1="23" y1="11" x2="17" y2="11"></line>
        </svg>
        Task Recipients
      </button>
    </div>

    <div class="section-container">
      <div class="jobs-row">
        <div class="job-col">
          <label for="docmanJobSelectNav">Docman Jobs</label>
          <select id="docmanJobSelectNav">
            <option value="">Select Docman job…</option>
            <option value="generate_output">Generate Output</option>
            <option value="docman_validate">Docman Validate</option>
            <option value="docman_import">Docman Import</option>
            <option value="docman_file">Docman File</option>
            <option value="merge_tasks_for_same_recipient">Merge Tasks for Same Recipient</option>
            <option value="publish_tasks">Publish Tasks</option>
            <option value="docman_review">Docman Review</option>
            <option value="docman_delete_original">Docman Delete Original</option>
            <option value="docman_upload">Docman Upload</option>
            <option value="docman_rejection">Docman Rejection</option>
          </select>
        </div>

        <div class="job-col">
          <label for="emisJobSelectNav">EMIS Jobs</label>
          <select id="emisJobSelectNav">
            <option value="">Select EMIS job…</option>
            <option value="emis_api_consultation">EMIS API Consultation</option>
            <option value="emis_unmatch">EMIS Unmatch</option>
            <option value="emis_prepare">EMIS Prepare</option>
            <option value="emis_delete_originals">EMIS Delete Originals</option>
            <option value="emis_rejection">EMIS Rejection</option>
          </select>
        </div>
      </div>
    </div>
    
    <div style="margin-bottom: 15px;">
      <label for="cdbSearchInput">Search by Practice CDB</label>
      <div class="input-with-button">
        <input id="cdbSearchInput" placeholder="Enter Practice CDB" autocomplete="off">
        <button id="searchCdbBtn" class="btn btn-sm">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </button>
      </div>
    </div>

    <ul id="cdbSuggestions"></ul>
    <div id="cdbSearchResult"></div>
    <div id="status"></div>
    <div id="statusDisplay"></div>
  </div>

  <div id="jobManagerView" class="job-manager-container view-transition" style="display: none;">
    
    <div id="documentSelectionSection" class="section-container">
      <h3>Document Selection</h3>
      <label for="documentDropdown">Document ID:</label>
      <div class="input-with-button">
        <input id="documentDropdown" placeholder="Enter or select document ID" autocomplete="off">
        <button id="copySelectedDocId" class="btn btn-sm">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
        <button id="clearDocId" class="btn btn-sm">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"></line>
            <line x1="6" y1="6" x2="18" y2="18"></line>
          </svg>
        </button>
        <div id="autocompleteResults" class="custom-autocomplete-results dropdown-stable"></div>
      </div>
    </div>

    <div id="jobSelectionSection" class="section-container">
      <h3>Bot Job Selection</h3>
      <label for="jobStatusInput">Job ID:</label>
      <div class="input-with-button">
        <input id="jobStatusInput" placeholder="Enter Job ID..." autocomplete="off">
      </div>
      <div class="button-grid" style="margin-top: 10px;">
        <button id="openJobStatusBtn" class="btn btn-sm">Open Status</button>
        <button id="copyJobStatusIdBtn" class="btn btn-sm">Copy ID</button>
        <button id="copyJobStatusUrlBtn" class="btn btn-sm">Copy URL</button>
        <button id="clearJobStatusInputBtn" class="btn btn-sm">Clear</button>
      </div>
    </div>

    <div id="mailroomDetailsSection" class="section-container" style="display: none;">
      <h3>Mailroom Details</h3>
      <div class="info-row">
        <span>Original Name:</span>
        <span id="mailroom-original-name" class="info-value">—</span>
      </div>
      <div class="info-row">
        <span>NHS No.:</span>
        <span id="mailroom-nhs-no" class="info-value">—</span>
      </div>
      <div class="info-row">
        <span>Patient Name:</span>
        <span id="mailroom-patient-name" class="info-value">—</span>
      </div>
      <div class="info-row">
        <span>Reason:</span>
        <span id="mailroom-reason" class="info-value">—</span>
      </div>
      <div class="info-row">
        <span>Rejected By / On:</span>
        <span id="mailroom-rejected-by-on" class="info-value">—</span>
      </div>
      <div class="info-row">
        <span>Status:</span>
        <span id="mailroom-status" class="info-value">—</span>
      </div>
      <div class="info-row">
        <span>Job ID (Mailroom):</span>
        <span id="mailroom-job-id" class="info-value">—</span>
      </div>
      <div class="info-row">
        <span>Inferred Type:</span>
        <span id="mailroom-inferred-type" class="info-value">—</span>
      </div>
      <button id="copyMailroomDetails" class="btn btn-sm" style="width: 100%; margin-top: 10px;">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
          <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
        </svg>
        Copy All Mailroom Details
      </button>
    </div>

    <div id="documentActionsSection" style="display: none;">
      <div class="section-container">
        <h3>Document Actions</h3>
        <div class="button-grid">
          <button id="openDocumentStatus" class="btn btn-sm">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            Status
          </button>
          <button id="openObanJob" class="btn btn-sm">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <circle cx="12" cy="12" r="10"></circle>
              <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
            Oban
          </button>
          <button id="openAnnotation" class="btn btn-sm">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M12 2a10 10 0 0 0-7 16.9"></path>
              <path d="M12 2a10 10 0 0 1 7 16.9"></path>
              <path d="M19 13v6h-6"></path>
              <path d="M5 13v6h6"></path>
            </svg>
            Annotation
          </button>
          <button id="openEventLog" class="btn btn-sm">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
            </svg>
            Evt Log
          </button>
          <button id="openLetterAdmin" class="btn btn-sm">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
              <polyline points="22,6 12,13 2,6"></polyline>
            </svg>
            L. Admin
          </button>
        </div>
      </div>
    </div>

    <div class="section-container">
      <h3>Practice Details (from Job Data)</h3>
      <label for="practiceDropdown">Practice Name:</label>
      <div class="input-with-button">
        <input id="practiceDropdown" placeholder="Enter or select practice" autocomplete="off">
        <button id="openPractice" class="btn btn-sm">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="10"></circle>
            <line x1="12" y1="8" x2="12" y2="16"></line>
            <line x1="8" y1="12" x2="16" y2="12"></line>
          </svg>
        </button>
        <button id="copyPracticeName" class="btn btn-sm">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
        <div id="practiceAutocompleteResultsContainer" class="custom-autocomplete-results"></div>
      </div>

      <div class="button-grid" style="margin-top: 10px;">
        <button id="docmanJobsBtn" class="btn btn-sm" disabled>Docman Jobs</button>
        <button id="emisJobsBtn" class="btn btn-sm" disabled>Emis Jobs</button>
        <button id="docmanValidateBtn" class="btn btn-sm" disabled>Docman Validate</button>
      </div>

      <div class="info-row" style="margin-top: 12px; border-bottom: none;">
        <span>ODS Code:</span>
        <span id="ods-code" class="info-value">—</span>
      </div>
    </div>

    <div class="section-container">
      <h3>Job Details</h3>
      <div class="info-row">
        <span>Job Type:</span>
        <span id="job-type-label" class="info-value">—</span>
      </div>
      <label for="job-id">Job ID:</label>
      <div class="input-with-button">
        <input type="text" id="job-id" readonly class="info-input">
        <button id="copy-job-id" class="btn btn-sm">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
        </button>
        <div id="jobIdAutocompleteResultsContainer" class="custom-autocomplete-results"></div>
      </div>
      <div class="button-grid" style="margin-bottom: 10px;">
        <button id="openJobDirect" class="btn btn-sm">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
            <polyline points="15 3 21 3 21 9"></polyline>
            <line x1="10" y1="14" x2="21" y2="3"></line>
          </svg>
          Open Job
        </button>
        <button id="copyJobPageUrl" class="btn btn-sm">
          <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
            <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
          </svg>
          Copy URL
        </button>
      </div>

      <div id="jobTitleSection" style="display: none;">
        <label for="jobTitleDisplay">Job Title:</label>
        <div class="input-with-button">
          <input type="text" id="jobTitleDisplay" readonly class="info-input">
          <button id="copyJobTitle" class="btn btn-sm">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
            </svg>
          </button>
        </div>
      </div>
    </div>

    <div id="toast"></div>
  </div>

  <div id="emailFormatterView" class="email-formatter-container view-transition" style="display: none;">
    
    <textarea id="inputEmailFormatter" placeholder="Paste email addresses here..."></textarea>
    <div class="button-grid" style="margin-bottom: 12px;">
      <button id="convertEmailBtn" class="btn btn-sm">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="17 1 21 5 17 9"></polyline><path d="M3 11V9a4 4 0 0 1 4-4h14"></path><polyline points="7 23 3 19 7 15"></polyline><path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
        </svg>
        Convert
      </button>
      <button id="nameOnlyBtn" class="btn btn-sm">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle>
        </svg>
        Name
      </button>
    </div>
    <textarea id="outputEmailFormatter" readonly placeholder="Comma-separated output..."></textarea>
    <button id="copyEmailBtn" class="btn">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
      </svg>
      Copy
    </button>
  </div>

  <script type="module" src="panel.js"></script>
</body>
</html>